YUI.add("gallery-dispatcher",function(b){var i=b.ClassNameManager.getClassName,k="dispatcher",s="script",v="fetch",r="purge",d="beforeExecute",u="load",p="ready",h="uri",e="content",f="autopurge",o="loading",q="node",g="normalize",a=/<\s*body.*?>(.*?)<\/\s*?body[^>\w]*?>/i,t=/<\s*head.*?>(.*?)<\/\s*?head[^>\w]*?>/i,c=i(k,"loading"),j=b.Lang,l=j.isBoolean,m=j.isString;function w(C,x){var z=b.Node.create("<div></div>"),B=z.cloneNode(),D={},y=null,A="";if(x&&(y=t.exec(C))){z.setContent(y[1]).all(s+",style,link").each(function(E){B.append(E);});A=B.get("innerHTML");}z.setContent(A+((y=a.exec(C))?y[1]:C));D.js=z.all(s).each(function(E){E.get("parentNode").removeChild(E);});D.content=z.get("innerHTML");return D;}function n(z,x,y){if(x&&x.on&&x.on[z]){x.on[z].apply(x.context||b,y);}}b.Dispatcher=b.Base.create(k,b.Base,[],{_queue:null,_io:null,initializer:function(x){x=x||{};this._queue=new b.AsyncQueue();this.after(e+"Change",function(y){this._dispatch(y.newVal);},this);this.after(h+"Change",function(y){this._fetch(y.newVal);},this);if(x[e]){this._dispatch(this.get(e));}if(x[h]){this._fetch(this.get(h));}},destructor:function(){this.stop();this._queue=null;this._io=null;},_dispatch:function(y){var x=this,A=w(y,this.get(g)),z=this._queue,B=this.get(q);this.stop();if(!B){return;}if(this.get(f)){z.add({fn:function(){B.get("children").each(function(C){C.purge(true);});x.fire(r,B);}});}z.add({fn:function(){B.setContent(A.content);x.fire(d,B);}});A.js.each(function(C){if(C&&C.get("src")){z.add({fn:function(){b.Get.script(C.get("src"),{onFailure:function(D){},onEnd:function(D){D.purge();z.run();}});},autoContinue:false});}else{z.add({fn:function(){var F=C.get("ownerDocument"),E=F.one("head")||F.get("documentElement"),D=b.one(document.createElement(s));if(C._node.text){D._node.text=C._node.text;}E.appendChild(D);D.remove();C.remove();}});}});z.add({fn:function(){x.fire(p);}});this._queue.run();},_fetch:function(z){var y=this.get("ioConfig")||{},x;this.stop();if(!z){return false;}x=b.merge({method:"GET"},y);x.on={start:function(){this._set(o,true);n("start",y,arguments);},success:function(A,B){this.set(e,B.responseText);n("success",y,arguments);},failure:function(A,B){n("failure",y,arguments);},end:function(){this._set(o,false);n("end",y,arguments);}};x.context=this;return(this._io=b.io(z,x));},stop:function(){this._queue.stop();if(this._io){this._io.abort();}return this;}},{EVENT_PREFIX:k,ATTRS:{node:{value:null,setter:function(x){this.stop();return b.one(x);}},autopurge:{value:true,validator:l},normalize:{value:false,validator:l},uri:{value:null,validator:function(x){return(x&&m(x)&&(x!==""));}},content:{value:"",validator:m},loading:{value:false,validator:l,readOnly:true,setter:function(x){if(x){this.fire(v);this.get(q).addClass(c);}else{this.fire(u);this.get(q).removeClass(c);}return x;}},ioConfig:{value:null}}});},"gallery-2010.09.15-18-40",{requires:["base","node-base","io-base","get","async-queue","classnamemanager"]});
